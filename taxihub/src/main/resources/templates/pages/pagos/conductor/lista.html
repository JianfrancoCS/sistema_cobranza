<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/system :: system(~{::content}, ${pageTitle}, ~{::scripts})}">
<head>
    <title th:text="${pageTitle}">Mis Pagos - Conductor - TaxiHub</title>
</head>
<body>

<div th:fragment="content" class="d-flex flex-column" style="height: 100%; overflow-y: auto;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-person-check me-2"></i>Mis Pagos</h2>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <form method="get" th:action="@{/pagos/conductor}" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label for="fecha" class="form-label">Fecha de pagos</label>
                    <input type="date" class="form-control" id="fecha" name="fecha" 
                           th:value="${fecha}" 
                           required>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search me-1"></i>Filtrar
                    </button>
                </div>
                <div class="col-md-2">
                    <a th:href="@{/pagos/conductor}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-clockwise me-1"></i>Limpiar
                    </a>
                </div>
                <div class="col-md-5 text-end">
                    <small class="text-muted">
                        Mostrando pagos del <span th:text="${#temporals.format(fecha, 'dd/MM/yyyy')}"></span>
                    </small>
                </div>
                
                <input type="hidden" name="page" th:value="${currentPage}">
                <input type="hidden" name="size" th:value="${currentSize}">
                <input type="hidden" name="sort" th:value="${currentSort}">
                <input type="hidden" name="direction" th:value="${currentDirection}">
            </form>
        </div>
    </div>

    <div class="flex-grow-1" style="overflow-y: auto; min-height: 0;">
        
        <div class="card shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Fecha</th>
                                <th>Modalidad</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Deuda ID</th>
                                <th>Detalle</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${pagos.isEmpty()}" class="text-center">
                                <td colspan="7" class="py-4">
                                    <i class="bi bi-inbox text-muted fs-1"></i>
                                    <p class="text-muted mt-2">No tienes pagos registrados</p>
                                    <p class="text-muted">Para crear un pago, ve a tu lista de deudas y selecciona una para pagar</p>
                                </td>
                            </tr>
                            <tr th:each="pago : ${pagos.content}" th:if="${!pagos.isEmpty()}">
                                <td th:text="${pago.id}">#123</td>
                                <td th:text="${#temporals.format(pago.fechaCreacion, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:30</td>
                                <td>
                                    <span th:text="${pago.modalidadPago}" 
                                          th:class="${pago.modalidadPago == 'EFECTIVO' ? 'badge bg-success' : 'badge bg-primary'}">
                                        EFECTIVO
                                    </span>
                                </td>
                                <td th:text="${'S/ ' + #numbers.formatDecimal(pago.montoPago, 1, 2)}">S/ 50.00</td>
                                <td>
                                    <span th:text="${pago.estado}"
                                          th:class="${pago.estado == 'APROBADO' ? 'badge bg-success' : 
                                                    (pago.estado == 'RECHAZADO' ? 'badge bg-danger' : 
                                                    (pago.estado == 'EN REVISION' ? 'badge bg-warning' : 'badge bg-secondary'))}">
                                        POR REVISAR
                                    </span>
                                </td>
                                <td th:text="${pago.deudaId}">#456</td>
                                <td>
                                    <a th:href="@{/pagos/ver/{id}(id=${pago.id})}" 
                                       class="btn btn-outline-info btn-sm" 
                                       title="Ver detalle">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <nav th:if="${!pagos.isEmpty() && pagos.totalPages > 1}" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${pagos.first ? 'disabled' : ''}">
                    <a class="page-link" th:href="@{/pagos/conductor(page=${pagos.number - 1}, size=${currentSize}, sort=${currentSort}, direction=${currentDirection}, fecha=${fecha})}">
                        Anterior
                    </a>
                </li>
                
                <li th:each="pageNum : ${#numbers.sequence(0, pagos.totalPages - 1)}" 
                    class="page-item" 
                    th:classappend="${pageNum == pagos.number ? 'active' : ''}">
                    <a class="page-link" th:href="@{/pagos/conductor(page=${pageNum}, size=${currentSize}, sort=${currentSort}, direction=${currentDirection}, fecha=${fecha})}" 
                       th:text="${pageNum + 1}">1</a>
                </li>
                
                <li class="page-item" th:classappend="${pagos.last ? 'disabled' : ''}">
                    <a class="page-link" th:href="@{/pagos/conductor(page=${pagos.number + 1}, size=${currentSize}, sort=${currentSort}, direction=${currentDirection}, fecha=${fecha})}">
                        Siguiente
                    </a>
                </li>
            </ul>
        </nav>
        
    </div>

    <div th:replace="~{fragments/modal-confirm :: simple}"></div>
</div>

<div th:fragment="scripts">
</div>

</body>
</html>